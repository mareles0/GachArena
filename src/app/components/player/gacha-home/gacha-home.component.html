<div class="gacha-home-container">
  <!-- Loading -->
  <div *ngIf="loading && !selectedBox" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-3">Carregando caixas...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && boxes.length === 0" class="empty-state">
    <i class="bi bi-inbox" style="font-size: 5rem; color: #ccc;"></i>
    <h3>Nenhuma caixa disponível</h3>
    <p>O administrador ainda não cadastrou caixas no sistema.</p>
    <p class="text-muted">Peça ao admin para popular o banco de dados em "Admin → Gerenciar Caixas"</p>
  </div>

  <!-- Grade de Caixas -->
  <div class="boxes-grid" *ngIf="!loading && boxes.length > 0">
    <div class="box-card" *ngFor="let box of boxes" 
         [class.normal-box]="box.type === 'NORMAL'" 
         [class.premium-box]="box.type === 'PREMIUM'"
         (click)="selectBox(box)">
      <div class="box-image">
        <img [src]="box.imageUrl" [alt]="box.name">
        <div class="box-type-badge" [class.premium]="box.type === 'PREMIUM'">
          {{ box.type === 'NORMAL' ? 'NORMAL' : 'PREMIUM' }}
        </div>
      </div>
      <div class="box-info">
        <h3>{{ box.name }}</h3>
        <p>{{ box.description }}</p>
      </div>
    </div>
  </div>

  <!-- Modal de Abertura de Caixa -->
  <div class="modal-overlay" *ngIf="selectedBox" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      
      <!-- Resultado -->
      <div class="box-result" *ngIf="showResult && drawnItem">
        <div class="result-card" [style.border-color]="getRarityColor(drawnItem.rarity)">
          <div class="rarity-glow" [style.background]="getRarityColor(drawnItem.rarity)"></div>
          <img [src]="drawnItem.imageUrl" [alt]="drawnItem.name" class="item-image">
          <h2>{{ drawnItem.name }}</h2>
          <div class="rarity-badge" [ngClass]="getRarityClass(drawnItem.rarity)">
            {{ drawnItem.rarity }}
          </div>
          <p class="item-description">{{ drawnItem.description }}</p>
          <div class="item-stats">
            <span class="power-stat">
              <i class="bi bi-lightning-fill"></i> Poder: {{ drawnItem.power }}
            </span>
          </div>
          <button class="btn btn-success mt-3" (click)="closeModal()">
            <i class="bi bi-check-circle"></i> Continuar
          </button>
        </div>
      </div>

      <!-- Preview da Caixa -->
      <div class="box-preview" *ngIf="!showResult">
        <button class="close-btn" (click)="closeModal()">
          <i class="bi bi-x-lg"></i>
        </button>
        
        <div class="preview-header">
          <h2>{{ selectedBox.name }}</h2>
          <span class="box-type" [class.premium]="selectedBox.type === 'PREMIUM'">
            {{ selectedBox.type }}
          </span>
        </div>

        <div class="preview-image">
          <img [src]="selectedBox.imageUrl" [alt]="selectedBox.name">
        </div>

        <p class="preview-description">{{ selectedBox.description }}</p>

        <div class="ticket-requirement">
          <i class="bi bi-{{ selectedBox.type === 'NORMAL' ? 'ticket-perforated' : 'star-fill' }}"></i>
          <span>Requer 1 Ticket {{ selectedBox.type === 'NORMAL' ? 'Normal' : 'Premium' }}</span>
        </div>

        <button class="btn btn-lg btn-primary open-btn" 
                [disabled]="loading"
                (click)="openBox()">
          <span *ngIf="!loading">
            <i class="bi bi-box-seam"></i> Abrir Caixa
          </span>
          <span *ngIf="loading">
            <span class="spinner-border spinner-border-sm me-2"></span>
            Abrindo...
          </span>
        </button>
      </div>
    </div>
  </div>
</div>
