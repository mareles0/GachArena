<div class="inventory-container">
<img src="https://i.pinimg.com/originals/87/b3/74/87b374a764bfa8f4ad403569455a9554.gif" class="bg-gif" alt="" aria-hidden="true">
     
    <video autoplay muted loop class="bg-video">
        <source src="assets/backgrounds/welcome.webm" type="video/webm">
        <source src="assets/backgrounds/welcome.mp4" type="video/mp4">
    </video>


  <div class="notification-toast" *ngIf="notification.show" 
       [class.success]="notification.type === 'success'"
       [class.error]="notification.type === 'error'"
       [class.info]="notification.type === 'info'">
    <i class="bi" [class.bi-check-circle-fill]="notification.type === 'success'"
                   [class.bi-x-circle-fill]="notification.type === 'error'"
                   [class.bi-info-circle-fill]="notification.type === 'info'"></i>
    <span>{{ notification.message }}</span>
    <button class="close-btn" (click)="notification.show = false">
      <i class="bi bi-x"></i>
    </button>
  </div>

  <div class="inventory-header">
    <h2><i class="bi bi-backpack"></i> Meu Inventário</h2>
    <div class="stats-card">
      <div class="stat-item">
        <i class="bi bi-box"></i>
        <div>
          <span class="stat-label">Total de Itens</span>
          <span class="stat-value">{{ userItems.length }}</span>
        </div>
      </div>
      <div class="stat-item">
        <i class="bi bi-lightning-fill"></i>
        <div>
          <span class="stat-label">Poder Total</span>
          <span class="stat-value">{{ getTotalPower() }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filter-section">
    <button *ngFor="let rarity of rarities" 
            class="filter-btn" 
            [class.active]="selectedRarity === rarity"
            [ngClass]="getRarityClass(rarity)"
            (click)="filterByRarity(rarity)">
      {{ rarity }}
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && filteredItems.length === 0" class="empty-state">
    <i class="bi bi-inbox"></i>
    <h3>Nenhum item encontrado</h3>
    <p>Abra caixas no Gacha para conseguir itens!</p>
    <a routerLink="/gacha" class="btn btn-primary">
      Ir para Gacha
    </a>
  </div>

  <!-- Items Grid -->
  <div class="items-grid" *ngIf="!loading && filteredItems.length > 0">
    <div class="item-card" *ngFor="let userItem of filteredItems" 
         [style.border-color]="getRarityColor(userItem.item.rarity)">
      <div class="item-quantity" *ngIf="userItem.quantity > 1">
        x{{ userItem.quantity }}
      </div>
      <div class="rarity-badge" [ngClass]="getRarityClass(userItem.item.rarity)">
        {{ userItem.item.rarity }}
        <span class="rarity-level" *ngIf="userItem.rarityLevel"> - Nível {{ userItem.rarityLevel }}</span>
      </div>
      <img [src]="userItem.item.imageUrl" 
           [alt]="userItem.item.name" 
           class="item-image clickable"
           (click)="showItemDetailsModal(userItem)">
      <div class="item-info">
        <h4>{{ userItem.item.name }}</h4>
        <p class="item-box">{{ userItem.item.boxName }}</p>
        <div class="item-power">
           {{ userItem.item.power }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Detalhes do Item -->
<div class="item-details-overlay" *ngIf="showItemDetails" (click)="closeItemDetailsModal()">
  <div class="item-details-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h5 class="modal-title">Detalhes do Item</h5>
      <button type="button" class="close-btn" (click)="closeItemDetailsModal()">
        <i class="bi bi-x"></i>
      </button>
    </div>
    <div class="modal-body" *ngIf="selectedItemForDetails">
      <div class="item-details-container">
        <div class="item-image-large">
          <img [src]="selectedItemForDetails.item.imageUrl" 
               [alt]="selectedItemForDetails.item.name"
               class="item-image-modal">
        </div>
        
        <div class="item-info-details">
          <h4 class="item-name-modal">{{ selectedItemForDetails.item.name }}</h4>
          <div class="rarity-badge" [style.background-color]="getRarityColor(selectedItemForDetails.item.rarity)">
            {{ selectedItemForDetails.item.rarity }}
          </div>
          
          <div class="item-stats">
            <div class="stat-row">
              <span class="stat-label">Poder:</span>
              <span class="stat-value">{{ selectedItemForDetails.item.power }}</span>
            </div>

            <div class="stat-row">
              <span class="stat-label">Pontos:</span>
              <span class="stat-value">{{ selectedItemForDetails?.points ?? 0 }}</span>
            </div>
            
            <div class="stat-row" *ngIf="selectedItemForDetails.rarityLevel">
              <span class="stat-label">Nível de Raridade:</span>
              <span class="stat-value">{{ selectedItemForDetails.rarityLevel }}/1000</span>
            </div>
            
            <div class="stat-row">
              <span class="stat-label">Caixa:</span>
              <span class="stat-value">{{ selectedItemForDetails.item.boxName }}</span>
            </div>
            
            <div class="stat-row">
              <span class="stat-label">Drop Rate:</span>
              <span class="stat-value">{{ selectedItemForDetails.item.dropRate }}%</span>
            </div>

            <div class="stat-row" *ngIf="selectedItemForDetails.quantity > 1">
              <span class="stat-label">Quantidade:</span>
              <span class="stat-value">{{ selectedItemForDetails.quantity }}</span>
            </div>
          </div>
          
          <div class="item-description" *ngIf="selectedItemForDetails.item.description">
            <p>{{ selectedItemForDetails.item.description }}</p>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="closeItemDetailsModal()">Fechar</button>
    </div>
  </div>
</div>
