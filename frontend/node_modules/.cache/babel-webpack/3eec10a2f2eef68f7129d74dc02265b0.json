{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/olimp/OneDrive/Documentos/estagio/Estagio-etapa-3/GachArena/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { environment } from '../../environments/environment';\nimport { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class TicketService {\n  constructor(http) {\n    this.http = http;\n    this.ticketsSubject = new BehaviorSubject({\n      normalTickets: 0,\n      premiumTickets: 0\n    });\n    this.tickets$ = this.ticketsSubject.asObservable();\n  }\n\n  getUserTickets(userId) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const tickets = yield _this.http.get(`${environment.backendUrl}/users/${userId}/tickets`).toPromise();\n\n      _this.ticketsSubject.next(tickets);\n\n      return tickets;\n    })();\n  }\n\n  useTicket(userId, type) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        yield _this2.http.post(`${environment.backendUrl}/users/${userId}/use-ticket`, {\n          type\n        }).toPromise(); // Atualizar o subject\n\n        const tickets = _this2.ticketsSubject.value;\n\n        if (type === 'NORMAL' && tickets.normalTickets > 0) {\n          _this2.ticketsSubject.next(Object.assign(Object.assign({}, tickets), {\n            normalTickets: tickets.normalTickets - 1\n          }));\n        } else if (type === 'PREMIUM' && tickets.premiumTickets > 0) {\n          _this2.ticketsSubject.next(Object.assign(Object.assign({}, tickets), {\n            premiumTickets: tickets.premiumTickets - 1\n          }));\n        }\n\n        return true;\n      } catch (error) {\n        return false;\n      }\n    })();\n  }\n\n  addTickets(userId, normalTickets, premiumTickets) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (normalTickets > 0) {\n        yield _this3.http.post(`${environment.backendUrl}/users/${userId}/tickets`, {\n          amount: normalTickets,\n          type: 'normal'\n        }).toPromise();\n      }\n\n      if (premiumTickets > 0) {\n        yield _this3.http.post(`${environment.backendUrl}/users/${userId}/tickets`, {\n          amount: premiumTickets,\n          type: 'premium'\n        }).toPromise();\n      }\n    })();\n  } // Método para forçar atualização dos tickets\n\n\n  refreshTickets(userId) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this4.getUserTickets(userId);\n    })();\n  }\n\n}\n\nTicketService.ɵfac = function TicketService_Factory(t) {\n  return new (t || TicketService)(i0.ɵɵinject(i1.HttpClient));\n};\n\nTicketService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: TicketService,\n  factory: TicketService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["C:/Users/olimp/OneDrive/Documentos/estagio/Estagio-etapa-3/GachArena/frontend/src/app/services/ticket.service.ts"],"names":["environment","BehaviorSubject","i0","i1","TicketService","constructor","http","ticketsSubject","normalTickets","premiumTickets","tickets$","asObservable","getUserTickets","userId","tickets","get","backendUrl","toPromise","next","useTicket","type","post","value","Object","assign","error","addTickets","amount","refreshTickets","ɵfac","TicketService_Factory","t","ɵɵinject","HttpClient","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":";AAAA,SAASA,WAAT,QAA4B,gCAA5B;AACA,SAASC,eAAT,QAAgC,MAAhC;AACA,OAAO,KAAKC,EAAZ,MAAoB,eAApB;AACA,OAAO,KAAKC,EAAZ,MAAoB,sBAApB;AACA,OAAO,MAAMC,aAAN,CAAoB;AACvBC,EAAAA,WAAW,CAACC,IAAD,EAAO;AACd,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKC,cAAL,GAAsB,IAAIN,eAAJ,CAAoB;AAAEO,MAAAA,aAAa,EAAE,CAAjB;AAAoBC,MAAAA,cAAc,EAAE;AAApC,KAApB,CAAtB;AACA,SAAKC,QAAL,GAAgB,KAAKH,cAAL,CAAoBI,YAApB,EAAhB;AACH;;AACKC,EAAAA,cAAc,CAACC,MAAD,EAAS;AAAA;;AAAA;AACzB,YAAMC,OAAO,SAAS,KAAI,CAACR,IAAL,CAAUS,GAAV,CAAe,GAAEf,WAAW,CAACgB,UAAW,UAASH,MAAO,UAAxD,EAAmEI,SAAnE,EAAtB;;AACA,MAAA,KAAI,CAACV,cAAL,CAAoBW,IAApB,CAAyBJ,OAAzB;;AACA,aAAOA,OAAP;AAHyB;AAI5B;;AACKK,EAAAA,SAAS,CAACN,MAAD,EAASO,IAAT,EAAe;AAAA;;AAAA;AAC1B,UAAI;AACA,cAAM,MAAI,CAACd,IAAL,CAAUe,IAAV,CAAgB,GAAErB,WAAW,CAACgB,UAAW,UAASH,MAAO,aAAzD,EAAuE;AAAEO,UAAAA;AAAF,SAAvE,EAAiFH,SAAjF,EAAN,CADA,CAEA;;AACA,cAAMH,OAAO,GAAG,MAAI,CAACP,cAAL,CAAoBe,KAApC;;AACA,YAAIF,IAAI,KAAK,QAAT,IAAqBN,OAAO,CAACN,aAAR,GAAwB,CAAjD,EAAoD;AAChD,UAAA,MAAI,CAACD,cAAL,CAAoBW,IAApB,CAAyBK,MAAM,CAACC,MAAP,CAAcD,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBV,OAAlB,CAAd,EAA0C;AAAEN,YAAAA,aAAa,EAAEM,OAAO,CAACN,aAAR,GAAwB;AAAzC,WAA1C,CAAzB;AACH,SAFD,MAGK,IAAIY,IAAI,KAAK,SAAT,IAAsBN,OAAO,CAACL,cAAR,GAAyB,CAAnD,EAAsD;AACvD,UAAA,MAAI,CAACF,cAAL,CAAoBW,IAApB,CAAyBK,MAAM,CAACC,MAAP,CAAcD,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBV,OAAlB,CAAd,EAA0C;AAAEL,YAAAA,cAAc,EAAEK,OAAO,CAACL,cAAR,GAAyB;AAA3C,WAA1C,CAAzB;AACH;;AACD,eAAO,IAAP;AACH,OAXD,CAYA,OAAOgB,KAAP,EAAc;AACV,eAAO,KAAP;AACH;AAfyB;AAgB7B;;AACKC,EAAAA,UAAU,CAACb,MAAD,EAASL,aAAT,EAAwBC,cAAxB,EAAwC;AAAA;;AAAA;AACpD,UAAID,aAAa,GAAG,CAApB,EAAuB;AACnB,cAAM,MAAI,CAACF,IAAL,CAAUe,IAAV,CAAgB,GAAErB,WAAW,CAACgB,UAAW,UAASH,MAAO,UAAzD,EAAoE;AAAEc,UAAAA,MAAM,EAAEnB,aAAV;AAAyBY,UAAAA,IAAI,EAAE;AAA/B,SAApE,EAA+GH,SAA/G,EAAN;AACH;;AACD,UAAIR,cAAc,GAAG,CAArB,EAAwB;AACpB,cAAM,MAAI,CAACH,IAAL,CAAUe,IAAV,CAAgB,GAAErB,WAAW,CAACgB,UAAW,UAASH,MAAO,UAAzD,EAAoE;AAAEc,UAAAA,MAAM,EAAElB,cAAV;AAA0BW,UAAAA,IAAI,EAAE;AAAhC,SAApE,EAAiHH,SAAjH,EAAN;AACH;AANmD;AAOvD,GAnCsB,CAoCvB;;;AACMW,EAAAA,cAAc,CAACf,MAAD,EAAS;AAAA;;AAAA;AACzB,YAAM,MAAI,CAACD,cAAL,CAAoBC,MAApB,CAAN;AADyB;AAE5B;;AAvCsB;;AAyC3BT,aAAa,CAACyB,IAAd,GAAqB,SAASC,qBAAT,CAA+BC,CAA/B,EAAkC;AAAE,SAAO,KAAKA,CAAC,IAAI3B,aAAV,EAAyBF,EAAE,CAAC8B,QAAH,CAAY7B,EAAE,CAAC8B,UAAf,CAAzB,CAAP;AAA8D,CAAvH;;AACA7B,aAAa,CAAC8B,KAAd,GAAsB,aAAchC,EAAE,CAACiC,kBAAH,CAAsB;AAAEC,EAAAA,KAAK,EAAEhC,aAAT;AAAwBiC,EAAAA,OAAO,EAAEjC,aAAa,CAACyB,IAA/C;AAAqDS,EAAAA,UAAU,EAAE;AAAjE,CAAtB,CAApC","sourcesContent":["import { environment } from '../../environments/environment';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/common/http\";\r\nexport class TicketService {\r\n    constructor(http) {\r\n        this.http = http;\r\n        this.ticketsSubject = new BehaviorSubject({ normalTickets: 0, premiumTickets: 0 });\r\n        this.tickets$ = this.ticketsSubject.asObservable();\r\n    }\r\n    async getUserTickets(userId) {\r\n        const tickets = await this.http.get(`${environment.backendUrl}/users/${userId}/tickets`).toPromise();\r\n        this.ticketsSubject.next(tickets);\r\n        return tickets;\r\n    }\r\n    async useTicket(userId, type) {\r\n        try {\r\n            await this.http.post(`${environment.backendUrl}/users/${userId}/use-ticket`, { type }).toPromise();\r\n            // Atualizar o subject\r\n            const tickets = this.ticketsSubject.value;\r\n            if (type === 'NORMAL' && tickets.normalTickets > 0) {\r\n                this.ticketsSubject.next(Object.assign(Object.assign({}, tickets), { normalTickets: tickets.normalTickets - 1 }));\r\n            }\r\n            else if (type === 'PREMIUM' && tickets.premiumTickets > 0) {\r\n                this.ticketsSubject.next(Object.assign(Object.assign({}, tickets), { premiumTickets: tickets.premiumTickets - 1 }));\r\n            }\r\n            return true;\r\n        }\r\n        catch (error) {\r\n            return false;\r\n        }\r\n    }\r\n    async addTickets(userId, normalTickets, premiumTickets) {\r\n        if (normalTickets > 0) {\r\n            await this.http.post(`${environment.backendUrl}/users/${userId}/tickets`, { amount: normalTickets, type: 'normal' }).toPromise();\r\n        }\r\n        if (premiumTickets > 0) {\r\n            await this.http.post(`${environment.backendUrl}/users/${userId}/tickets`, { amount: premiumTickets, type: 'premium' }).toPromise();\r\n        }\r\n    }\r\n    // Método para forçar atualização dos tickets\r\n    async refreshTickets(userId) {\r\n        await this.getUserTickets(userId);\r\n    }\r\n}\r\nTicketService.ɵfac = function TicketService_Factory(t) { return new (t || TicketService)(i0.ɵɵinject(i1.HttpClient)); };\r\nTicketService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: TicketService, factory: TicketService.ɵfac, providedIn: 'root' });\r\n"]},"metadata":{},"sourceType":"module"}