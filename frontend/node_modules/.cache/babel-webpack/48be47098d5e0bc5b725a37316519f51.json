{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/olimp/OneDrive/Documentos/estagio/Estagio-etapa-3/GachArena/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class TicketService {\n  constructor(http) {\n    this.http = http;\n    this.ticketsSubject = new BehaviorSubject({\n      normalTickets: 0,\n      premiumTickets: 0\n    });\n    this.tickets$ = this.ticketsSubject.asObservable();\n  }\n\n  getUserTickets(userId) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const docRef = doc(_this.db, 'users', userId);\n      const docSnap = yield getDoc(docRef);\n\n      if (docSnap.exists()) {\n        const data = docSnap.data();\n        const tickets = {\n          normalTickets: data.normalTickets || 0,\n          premiumTickets: data.premiumTickets || 0\n        };\n\n        _this.ticketsSubject.next(tickets);\n\n        return tickets;\n      }\n\n      const defaultTickets = {\n        normalTickets: 0,\n        premiumTickets: 0\n      };\n\n      _this.ticketsSubject.next(defaultTickets);\n\n      return defaultTickets;\n    })();\n  }\n\n  useTicket(userId, type) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const tickets = yield _this2.getUserTickets(userId);\n      const docRef = doc(_this2.db, 'users', userId);\n\n      if (type === 'NORMAL' && tickets.normalTickets > 0) {\n        yield updateDoc(docRef, {\n          normalTickets: increment(-1)\n        }); // Atualizar o subject após usar ticket\n\n        const updatedTickets = Object.assign(Object.assign({}, tickets), {\n          normalTickets: tickets.normalTickets - 1\n        });\n\n        _this2.ticketsSubject.next(updatedTickets);\n\n        return true;\n      } else if (type === 'PREMIUM' && tickets.premiumTickets > 0) {\n        yield updateDoc(docRef, {\n          premiumTickets: increment(-1)\n        }); // Atualizar o subject após usar ticket\n\n        const updatedTickets = Object.assign(Object.assign({}, tickets), {\n          premiumTickets: tickets.premiumTickets - 1\n        });\n\n        _this2.ticketsSubject.next(updatedTickets);\n\n        return true;\n      }\n\n      return false;\n    })();\n  }\n\n  addTickets(userId, normalTickets, premiumTickets) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      const docRef = doc(_this3.db, 'users', userId); // Check if user document exists; if not, create it with initial amounts\n\n      const docSnap = yield getDoc(docRef);\n\n      if (!docSnap.exists()) {\n        yield setDoc(docRef, {\n          normalTickets: normalTickets || 0,\n          premiumTickets: premiumTickets || 0\n        });\n        return;\n      }\n\n      yield updateDoc(docRef, {\n        normalTickets: increment(normalTickets),\n        premiumTickets: increment(premiumTickets)\n      }); // Não atualizar o subject aqui para evitar bug visual na navbar do admin\n    })();\n  } // Método para forçar atualização dos tickets\n\n\n  refreshTickets(userId) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this4.getUserTickets(userId);\n    })();\n  }\n\n}\n\nTicketService.ɵfac = function TicketService_Factory(t) {\n  return new (t || TicketService)(i0.ɵɵinject(i1.HttpClient));\n};\n\nTicketService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: TicketService,\n  factory: TicketService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["C:/Users/olimp/OneDrive/Documentos/estagio/Estagio-etapa-3/GachArena/frontend/src/app/services/ticket.service.ts"],"names":["BehaviorSubject","i0","i1","TicketService","constructor","http","ticketsSubject","normalTickets","premiumTickets","tickets$","asObservable","getUserTickets","userId","docRef","doc","db","docSnap","getDoc","exists","data","tickets","next","defaultTickets","useTicket","type","updateDoc","increment","updatedTickets","Object","assign","addTickets","setDoc","refreshTickets","ɵfac","TicketService_Factory","t","ɵɵinject","HttpClient","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":"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","sourcesContent":["import { BehaviorSubject } from 'rxjs';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/common/http\";\r\nexport class TicketService {\r\n    constructor(http) {\r\n        this.http = http;\r\n        this.ticketsSubject = new BehaviorSubject({ normalTickets: 0, premiumTickets: 0 });\r\n        this.tickets$ = this.ticketsSubject.asObservable();\r\n    }\r\n    async getUserTickets(userId) {\r\n        const docRef = doc(this.db, 'users', userId);\r\n        const docSnap = await getDoc(docRef);\r\n        if (docSnap.exists()) {\r\n            const data = docSnap.data();\r\n            const tickets = {\r\n                normalTickets: data.normalTickets || 0,\r\n                premiumTickets: data.premiumTickets || 0\r\n            };\r\n            this.ticketsSubject.next(tickets);\r\n            return tickets;\r\n        }\r\n        const defaultTickets = { normalTickets: 0, premiumTickets: 0 };\r\n        this.ticketsSubject.next(defaultTickets);\r\n        return defaultTickets;\r\n    }\r\n    async useTicket(userId, type) {\r\n        const tickets = await this.getUserTickets(userId);\r\n        const docRef = doc(this.db, 'users', userId);\r\n        if (type === 'NORMAL' && tickets.normalTickets > 0) {\r\n            await updateDoc(docRef, {\r\n                normalTickets: increment(-1)\r\n            });\r\n            // Atualizar o subject após usar ticket\r\n            const updatedTickets = Object.assign(Object.assign({}, tickets), { normalTickets: tickets.normalTickets - 1 });\r\n            this.ticketsSubject.next(updatedTickets);\r\n            return true;\r\n        }\r\n        else if (type === 'PREMIUM' && tickets.premiumTickets > 0) {\r\n            await updateDoc(docRef, {\r\n                premiumTickets: increment(-1)\r\n            });\r\n            // Atualizar o subject após usar ticket\r\n            const updatedTickets = Object.assign(Object.assign({}, tickets), { premiumTickets: tickets.premiumTickets - 1 });\r\n            this.ticketsSubject.next(updatedTickets);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    async addTickets(userId, normalTickets, premiumTickets) {\r\n        const docRef = doc(this.db, 'users', userId);\r\n        // Check if user document exists; if not, create it with initial amounts\r\n        const docSnap = await getDoc(docRef);\r\n        if (!docSnap.exists()) {\r\n            await setDoc(docRef, {\r\n                normalTickets: normalTickets || 0,\r\n                premiumTickets: premiumTickets || 0\r\n            });\r\n            return;\r\n        }\r\n        await updateDoc(docRef, {\r\n            normalTickets: increment(normalTickets),\r\n            premiumTickets: increment(premiumTickets)\r\n        });\r\n        // Não atualizar o subject aqui para evitar bug visual na navbar do admin\r\n    }\r\n    // Método para forçar atualização dos tickets\r\n    async refreshTickets(userId) {\r\n        await this.getUserTickets(userId);\r\n    }\r\n}\r\nTicketService.ɵfac = function TicketService_Factory(t) { return new (t || TicketService)(i0.ɵɵinject(i1.HttpClient)); };\r\nTicketService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: TicketService, factory: TicketService.ɵfac, providedIn: 'root' });\r\n"]},"metadata":{},"sourceType":"module"}