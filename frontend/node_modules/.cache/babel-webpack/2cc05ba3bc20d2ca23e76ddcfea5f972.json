{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/olimp/OneDrive/Documentos/estagio/Estagio-etapa-3/GachArena/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, sendPasswordResetEmail, sendEmailVerification, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from 'firebase/auth';\nimport { auth } from '../firebase.config';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    constructor(router) {\n      this.router = router;\n      this.currentUser = null;\n      onAuthStateChanged(auth, user => {\n        console.log('[AuthService] Estado de autenticação mudou:', user === null || user === void 0 ? void 0 : user.uid);\n        this.currentUser = user;\n      });\n    } // Registrar novo usuário\n\n\n    register(email, password) {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        try {\n          const result = yield createUserWithEmailAndPassword(auth, email, password);\n\n          if (result.user) {\n            yield sendEmailVerification(result.user);\n          }\n\n          return result;\n        } catch (error) {\n          throw _this.handleError(error);\n        }\n      })();\n    } // Login\n\n\n    login(email, password) {\n      var _this2 = this;\n\n      return _asyncToGenerator(function* () {\n        try {\n          const result = yield signInWithEmailAndPassword(auth, email, password); // Verificar se o email foi verificado\n\n          if (result.user && !result.user.emailVerified) {\n            yield signOut(auth);\n            throw 'Por favor, verifique seu email antes de fazer login.';\n          }\n\n          _this2.currentUser = result.user;\n          console.log('[AuthService] Login bem-sucedido:', result.user.uid);\n          return result;\n        } catch (error) {\n          if (typeof error === 'string') {\n            throw error;\n          }\n\n          throw _this2.handleError(error);\n        }\n      })();\n    } // Logout\n\n\n    logout() {\n      var _this3 = this;\n\n      return _asyncToGenerator(function* () {\n        yield signOut(auth);\n        _this3.currentUser = null;\n\n        _this3.router.navigate(['/login']);\n      })();\n    } // Recuperar senha\n\n\n    resetPassword(email) {\n      var _this4 = this;\n\n      return _asyncToGenerator(function* () {\n        try {\n          yield sendPasswordResetEmail(auth, email);\n          return 'E-mail de recuperação enviado com sucesso!';\n        } catch (error) {\n          throw _this4.handleError(error);\n        }\n      })();\n    } // Verificar se está logado\n\n\n    isLoggedIn() {\n      return this.currentUser !== null;\n    } // Reenviar email de verificação\n\n\n    resendVerificationEmail() {\n      var _this5 = this;\n\n      return _asyncToGenerator(function* () {\n        try {\n          if (_this5.currentUser) {\n            yield sendEmailVerification(_this5.currentUser);\n            return 'E-mail de verificação reenviado com sucesso!';\n          }\n\n          throw 'Nenhum usuário logado.';\n        } catch (error) {\n          throw _this5.handleError(error);\n        }\n      })();\n    } // Verificar se email foi verificado\n\n\n    isEmailVerified() {\n      var _a;\n\n      return ((_a = this.currentUser) === null || _a === void 0 ? void 0 : _a.emailVerified) || false;\n    }\n\n    getCurrentUser() {\n      var _this6 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise(resolve => {\n          if (_this6.currentUser) {\n            resolve(_this6.currentUser);\n          } else {\n            const unsubscribe = onAuthStateChanged(auth, user => {\n              unsubscribe();\n              _this6.currentUser = user;\n              resolve(user);\n            });\n          }\n        });\n      })();\n    } // Login com Google\n\n\n    loginWithGoogle() {\n      var _this7 = this;\n\n      return _asyncToGenerator(function* () {\n        try {\n          const provider = new GoogleAuthProvider();\n          const result = yield signInWithPopup(auth, provider);\n          _this7.currentUser = result.user;\n          console.log('[AuthService] Login com Google bem-sucedido:', result.user.uid);\n          return result;\n        } catch (error) {\n          throw _this7.handleError(error);\n        }\n      })();\n    } // Tratar erros\n\n\n    handleError(error) {\n      switch (error.code) {\n        case 'auth/email-already-in-use':\n          return 'Este e-mail já está em uso.';\n\n        case 'auth/invalid-email':\n          return 'E-mail inválido.';\n\n        case 'auth/weak-password':\n          return 'A senha deve ter pelo menos 6 caracteres.';\n\n        case 'auth/user-not-found':\n          return 'Usuário não encontrado.';\n\n        case 'auth/wrong-password':\n          return 'Senha incorreta.';\n\n        default:\n          return 'Erro ao autenticar. Tente novamente.';\n      }\n    }\n\n  }\n\n  AuthService.ɵfac = function AuthService_Factory(t) {\n    return new (t || AuthService)(i0.ɵɵinject(i1.Router));\n  };\n\n  AuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module"}