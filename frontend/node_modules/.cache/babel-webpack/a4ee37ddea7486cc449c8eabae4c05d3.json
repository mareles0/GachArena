{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/olimp/OneDrive/Documentos/estagio/Estagio-etapa-3/GachArena/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, sendPasswordResetEmail, sendEmailVerification, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from 'firebase/auth';\nimport { auth } from '../firebase.config';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nexport class AuthService {\n  constructor(router) {\n    this.router = router;\n    this.currentUser = null;\n    onAuthStateChanged(auth, user => {\n      console.log('[AuthService] Estado de autenticação mudou:', user === null || user === void 0 ? void 0 : user.uid);\n      this.currentUser = user;\n    });\n  } // Registrar novo usuário\n\n\n  register(email, password) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        const result = yield createUserWithEmailAndPassword(auth, email, password);\n\n        if (result.user) {\n          yield sendEmailVerification(result.user);\n        }\n\n        return result;\n      } catch (error) {\n        throw _this.handleError(error);\n      }\n    })();\n  } // Login\n\n\n  login(email, password) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        const result = yield signInWithEmailAndPassword(auth, email, password); // Verificar se o email foi verificado\n\n        if (result.user && !result.user.emailVerified) {\n          yield signOut(auth);\n          throw 'Por favor, verifique seu email antes de fazer login.';\n        }\n\n        _this2.currentUser = result.user;\n        console.log('[AuthService] Login bem-sucedido:', result.user.uid);\n        return result;\n      } catch (error) {\n        if (typeof error === 'string') {\n          throw error;\n        }\n\n        throw _this2.handleError(error);\n      }\n    })();\n  } // Logout\n\n\n  logout() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      yield signOut(auth);\n      _this3.currentUser = null;\n\n      _this3.router.navigate(['/login']);\n    })();\n  } // Recuperar senha\n\n\n  resetPassword(email) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        yield sendPasswordResetEmail(auth, email);\n        return 'E-mail de recuperação enviado com sucesso!';\n      } catch (error) {\n        throw _this4.handleError(error);\n      }\n    })();\n  } // Verificar se está logado\n\n\n  isLoggedIn() {\n    return this.currentUser !== null;\n  } // Reenviar email de verificação\n\n\n  resendVerificationEmail() {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        if (_this5.currentUser) {\n          yield sendEmailVerification(_this5.currentUser);\n          return 'E-mail de verificação reenviado com sucesso!';\n        }\n\n        throw 'Nenhum usuário logado.';\n      } catch (error) {\n        throw _this5.handleError(error);\n      }\n    })();\n  } // Verificar se email foi verificado\n\n\n  isEmailVerified() {\n    var _a;\n\n    return ((_a = this.currentUser) === null || _a === void 0 ? void 0 : _a.emailVerified) || false;\n  }\n\n  getCurrentUser() {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      return new Promise(resolve => {\n        if (_this6.currentUser) {\n          resolve(_this6.currentUser);\n        } else {\n          const unsubscribe = onAuthStateChanged(auth, user => {\n            unsubscribe();\n            _this6.currentUser = user;\n            resolve(user);\n          });\n        }\n      });\n    })();\n  } // Login com Google\n\n\n  loginWithGoogle() {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        const provider = new GoogleAuthProvider();\n        const result = yield signInWithPopup(auth, provider);\n        _this7.currentUser = result.user;\n        console.log('[AuthService] Login com Google bem-sucedido:', result.user.uid);\n        return result;\n      } catch (error) {\n        throw _this7.handleError(error);\n      }\n    })();\n  } // Tratar erros\n\n\n  handleError(error) {\n    switch (error.code) {\n      case 'auth/email-already-in-use':\n        return 'Este e-mail já está em uso.';\n\n      case 'auth/invalid-email':\n        return 'E-mail inválido.';\n\n      case 'auth/weak-password':\n        return 'A senha deve ter pelo menos 6 caracteres.';\n\n      case 'auth/user-not-found':\n        return 'Usuário não encontrado.';\n\n      case 'auth/wrong-password':\n        return 'Senha incorreta.';\n\n      default:\n        return 'Erro ao autenticar. Tente novamente.';\n    }\n  }\n\n}\n\nAuthService.ɵfac = function AuthService_Factory(t) {\n  return new (t || AuthService)(i0.ɵɵinject(i1.Router));\n};\n\nAuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthService,\n  factory: AuthService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["C:/Users/olimp/OneDrive/Documentos/estagio/Estagio-etapa-3/GachArena/frontend/src/app/services/auth.service.ts"],"names":["createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","sendPasswordResetEmail","sendEmailVerification","signInWithPopup","GoogleAuthProvider","onAuthStateChanged","auth","i0","i1","AuthService","constructor","router","currentUser","user","console","log","uid","register","email","password","result","error","handleError","login","emailVerified","logout","navigate","resetPassword","isLoggedIn","resendVerificationEmail","isEmailVerified","_a","getCurrentUser","Promise","resolve","unsubscribe","loginWithGoogle","provider","code","ɵfac","AuthService_Factory","t","ɵɵinject","Router","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":"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","sourcesContent":["import { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, sendPasswordResetEmail, sendEmailVerification, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from 'firebase/auth';\r\nimport { auth } from '../firebase.config';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/router\";\r\nexport class AuthService {\r\n    constructor(router) {\r\n        this.router = router;\r\n        this.currentUser = null;\r\n        onAuthStateChanged(auth, (user) => {\r\n            console.log('[AuthService] Estado de autenticação mudou:', user === null || user === void 0 ? void 0 : user.uid);\r\n            this.currentUser = user;\r\n        });\r\n    }\r\n    // Registrar novo usuário\r\n    async register(email, password) {\r\n        try {\r\n            const result = await createUserWithEmailAndPassword(auth, email, password);\r\n            if (result.user) {\r\n                await sendEmailVerification(result.user);\r\n            }\r\n            return result;\r\n        }\r\n        catch (error) {\r\n            throw this.handleError(error);\r\n        }\r\n    }\r\n    // Login\r\n    async login(email, password) {\r\n        try {\r\n            const result = await signInWithEmailAndPassword(auth, email, password);\r\n            // Verificar se o email foi verificado\r\n            if (result.user && !result.user.emailVerified) {\r\n                await signOut(auth);\r\n                throw 'Por favor, verifique seu email antes de fazer login.';\r\n            }\r\n            this.currentUser = result.user;\r\n            console.log('[AuthService] Login bem-sucedido:', result.user.uid);\r\n            return result;\r\n        }\r\n        catch (error) {\r\n            if (typeof error === 'string') {\r\n                throw error;\r\n            }\r\n            throw this.handleError(error);\r\n        }\r\n    }\r\n    // Logout\r\n    async logout() {\r\n        await signOut(auth);\r\n        this.currentUser = null;\r\n        this.router.navigate(['/login']);\r\n    }\r\n    // Recuperar senha\r\n    async resetPassword(email) {\r\n        try {\r\n            await sendPasswordResetEmail(auth, email);\r\n            return 'E-mail de recuperação enviado com sucesso!';\r\n        }\r\n        catch (error) {\r\n            throw this.handleError(error);\r\n        }\r\n    }\r\n    // Verificar se está logado\r\n    isLoggedIn() {\r\n        return this.currentUser !== null;\r\n    }\r\n    // Reenviar email de verificação\r\n    async resendVerificationEmail() {\r\n        try {\r\n            if (this.currentUser) {\r\n                await sendEmailVerification(this.currentUser);\r\n                return 'E-mail de verificação reenviado com sucesso!';\r\n            }\r\n            throw 'Nenhum usuário logado.';\r\n        }\r\n        catch (error) {\r\n            throw this.handleError(error);\r\n        }\r\n    }\r\n    // Verificar se email foi verificado\r\n    isEmailVerified() {\r\n        var _a;\r\n        return ((_a = this.currentUser) === null || _a === void 0 ? void 0 : _a.emailVerified) || false;\r\n    }\r\n    async getCurrentUser() {\r\n        return new Promise((resolve) => {\r\n            if (this.currentUser) {\r\n                resolve(this.currentUser);\r\n            }\r\n            else {\r\n                const unsubscribe = onAuthStateChanged(auth, (user) => {\r\n                    unsubscribe();\r\n                    this.currentUser = user;\r\n                    resolve(user);\r\n                });\r\n            }\r\n        });\r\n    }\r\n    // Login com Google\r\n    async loginWithGoogle() {\r\n        try {\r\n            const provider = new GoogleAuthProvider();\r\n            const result = await signInWithPopup(auth, provider);\r\n            this.currentUser = result.user;\r\n            console.log('[AuthService] Login com Google bem-sucedido:', result.user.uid);\r\n            return result;\r\n        }\r\n        catch (error) {\r\n            throw this.handleError(error);\r\n        }\r\n    }\r\n    // Tratar erros\r\n    handleError(error) {\r\n        switch (error.code) {\r\n            case 'auth/email-already-in-use':\r\n                return 'Este e-mail já está em uso.';\r\n            case 'auth/invalid-email':\r\n                return 'E-mail inválido.';\r\n            case 'auth/weak-password':\r\n                return 'A senha deve ter pelo menos 6 caracteres.';\r\n            case 'auth/user-not-found':\r\n                return 'Usuário não encontrado.';\r\n            case 'auth/wrong-password':\r\n                return 'Senha incorreta.';\r\n            default:\r\n                return 'Erro ao autenticar. Tente novamente.';\r\n        }\r\n    }\r\n}\r\nAuthService.ɵfac = function AuthService_Factory(t) { return new (t || AuthService)(i0.ɵɵinject(i1.Router)); };\r\nAuthService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: AuthService, factory: AuthService.ɵfac, providedIn: 'root' });\r\n"]},"metadata":{},"sourceType":"module"}