<nav *ngIf="showNavbar" [ngClass]="{ 'low-z': lowZ, 'high-z': highZ }" class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" routerLink="/">
      <i class="bi bi-box-seam"></i> GachArena
    </a>
    
    <!-- Compact actions shown on small screens: tickets + profile -->
    <div class="nav-compact d-flex align-items-center gap-2 d-flex d-lg-none" *ngIf="isLoggedIn">
      <div class="ticket-display normal">
        <img src="https://static.wikitide.net/cravesagawiki/4/46/Platinum_Gacha_Ticket.png" alt="Ticket Normal" class="ticket-icon">
        <span class="ticket-amount">{{ tickets.normalTickets }}</span>
      </div>
      <div class="ticket-display premium">
        <img src="https://static.wikitide.net/cravesagawiki/f/fe/SR_or_Higher_Gacha_Ticket.png" alt="Ticket Premium" class="ticket-icon">
        <span class="ticket-amount">{{ tickets.premiumTickets }}</span>
      </div>

      <div class="dropdown">
        <button class="btn btn-link p-0 nav-compact-user d-flex align-items-center" id="compactUserDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <img *ngIf="photoURL" [src]="photoURL" alt="Avatar" class="user-avatar me-1">
          <i *ngIf="!photoURL" class="bi bi-person-circle" style="font-size:1.2rem;"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="compactUserDropdown">
          <li><a class="dropdown-item" [routerLink]="['/profile', userId]" style="cursor: pointer;"><i class="bi bi-person-circle"></i> Perfil</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" (click)="logout()" style="cursor: pointer;"><i class="bi bi-box-arrow-right"></i> Sair</a></li>
        </ul>
      </div>

      <!-- Toggler moved here to the right of tickets & profile on small screens -->
      <button class="navbar-toggler ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item" *ngIf="isLoggedIn">
          <a class="nav-link" routerLink="/gacha" routerLinkActive="active">
            <i class="bi bi-box"></i> Gacha
          </a>
        </li>
        <li class="nav-item" *ngIf="isLoggedIn">
          <a class="nav-link" routerLink="/inventario" routerLinkActive="active">
            <i class="bi bi-backpack"></i> Inventário
          </a>
        </li>
        <li class="nav-item" *ngIf="isLoggedIn">
          <a class="nav-link" routerLink="/ranking" routerLinkActive="active">
            <i class="bi bi-trophy"></i> Ranking
          </a>
        </li>
        <li class="nav-item" *ngIf="isLoggedIn">
          <a class="nav-link" routerLink="/missoes" routerLinkActive="active">
            <i class="bi bi-list-task"></i> Missões
          </a>
        </li>
        <li class="nav-item" *ngIf="isLoggedIn">
          <a class="nav-link" routerLink="/amigos" routerLinkActive="active">
            <i class="bi bi-people"></i> Amigos
          </a>
        </li>
        <li class="nav-item" *ngIf="isLoggedIn">
          <a class="nav-link" routerLink="/trades" routerLinkActive="active">
            <i class="bi bi-arrow-left-right"></i> Trocas
          </a>
        </li>
        <li class="nav-item" *ngIf="isLoggedIn"><a class="nav-link" routerLink="/trade-up" routerLinkActive="active"><i class="bi bi-shop"></i> Mercado de Troca</a></li>

        <!-- Admin Menu -->
        <li class="nav-item dropdown" *ngIf="isLoggedIn && isAdmin">
          <a class="nav-link dropdown-toggle" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="cursor: pointer;">
            <i class="bi bi-gear"></i> Administração
          </a>
          <ul class="dropdown-menu" aria-labelledby="adminDropdown">
            <li><a class="dropdown-item" routerLink="/admin/caixas">
              <i class="bi bi-box-seam"></i> Gerenciar Caixas
            </a></li>
            <li><a class="dropdown-item" routerLink="/admin/itens">
              <i class="bi bi-card-image"></i> Gerenciar Itens
            </a></li>
            <li><a class="dropdown-item" routerLink="/admin/usuarios">
              <i class="bi bi-person-badge"></i> Gerenciar Usuários
            </a></li>
            <li><a class="dropdown-item" routerLink="/admin/missoes">
              <i class="bi bi-list-check"></i> Gerenciar Missões
            </a></li>
          </ul>
        </li>
      </ul>

      <!-- Tickets Display (Disponível para todos os usuários logados) -->
      <ul class="navbar-nav mx-3 d-none d-lg-flex" *ngIf="isLoggedIn">
        <li class="nav-item d-flex align-items-center gap-3">
          <div class="ticket-display normal">
            <img src="https://static.wikitide.net/cravesagawiki/4/46/Platinum_Gacha_Ticket.png" alt="Ticket Normal" class="ticket-icon">
            <span class="ticket-amount">{{ tickets.normalTickets }}</span>
          </div>
          <div class="ticket-display premium">
            <img src="https://static.wikitide.net/cravesagawiki/f/fe/SR_or_Higher_Gacha_Ticket.png" alt="Ticket Premium" class="ticket-icon">
            <span class="ticket-amount">{{ tickets.premiumTickets }}</span>
          </div>
        </li>
      </ul>

      <!-- User Menu -->
      <ul class="navbar-nav">
        <li class="nav-item" *ngIf="!isLoggedIn">
          <a class="nav-link" routerLink="/login">
            <i class="bi bi-box-arrow-in-right"></i> Entrar
          </a>
        </li>
        <li class="nav-item" *ngIf="!isLoggedIn">
          <a class="nav-link" routerLink="/register">
            <i class="bi bi-person-plus"></i> Registrar
          </a>
        </li>

        <li class="nav-item dropdown d-none d-lg-flex" *ngIf="isLoggedIn">
          <a class="nav-link dropdown-toggle d-flex align-items-center" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="cursor: pointer;">
            <img *ngIf="photoURL" [src]="photoURL" alt="Avatar" class="user-avatar me-2">
            <i *ngIf="!photoURL" class="bi bi-person-circle me-2" style="font-size: 1.5rem;"></i>
            {{ username }}
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" [routerLink]="['/profile', userId]" style="cursor: pointer;">
              <i class="bi bi-person-circle"></i> Perfil
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" (click)="logout()" style="cursor: pointer;">
              <i class="bi bi-box-arrow-right"></i> Sair
            </a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
