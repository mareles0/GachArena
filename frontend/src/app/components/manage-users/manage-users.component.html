<div class="manage-container">
<img src="https://i.pinimg.com/originals/1b/3c/58/1b3c5821c4ef798f196b30cc3eb46ac2.gif" class="bg-gif" alt="" aria-hidden="true">
     
    <video autoplay muted loop class="bg-video">
        <source src="assets/backgrounds/welcome.webm" type="video/webm">
        <source src="assets/backgrounds/welcome.mp4" type="video/mp4">
    </video><img src="https://i.pinimg.com/originals/1b/3c/58/1b3c5821c4ef798f196b30cc3eb46ac2.gif" class="bg-gif" alt="" aria-hidden="true">

  <div class="notification-container" *ngIf="notification.show">
    <div class="notification" [ngClass]="notification.type">{{ notification.message }}</div>
  </div>

  <h1><i class="bi bi-person-gear"></i> Gerenciar Usu치rios</h1>

  <input [(ngModel)]="searchTerm" (input)="filterUsers()" placeholder="Buscar usu치rios..." class="search-input">

  <div class="loading" *ngIf="isLoading">Carregando...</div>

  <table *ngIf="!isLoading">
    <thead>
      <tr>
        <th>Usu치rio</th>
        <th>Email</th>
        <th>Tipo</th>
        <th>Tickets Normais</th>
        <th>Tickets Premium</th>
        <th>Status</th>
        <th>A칞칫es</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of filteredUsers">
        <td>{{ user.username }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.userType }}</td>
        <td>{{ user.normalTickets || 0 }}</td>
        <td>{{ user.premiumTickets || 0 }}</td>
        <td>
          <span class="badge" [class.banned]="user.isBanned">
            {{ user.isBanned ? 'Banido' : 'Ativo' }}
          </span>
        </td>
        <td>
          <button (click)="toggleBan(user)" class="btn-action">
            {{ user.isBanned ? 'Desbanir' : 'Banir' }}
          </button>
          <button (click)="addTickets(user)" class="btn-action">+ Tickets</button>
          <button (click)="changeRole(user)" class="btn-action">Alterar Cargo</button>
          <button (click)="viewInventory(user)" class="btn-action">Ver Invent치rio</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Modal de Adicionar Tickets -->
<div class="modal-overlay" *ngIf="showTicketModal" (click)="closeTicketModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Adicionar Tickets</h3>
      <button class="close-btn" (click)="closeTicketModal()">칑</button>
    </div>
    
    <div class="modal-body">
      <p><strong>Usu치rio:</strong> {{ selectedUser?.username }}</p>
      
      <div class="form-group">
        <label>Tipo de Ticket:</label>
        <div class="ticket-type-selector">
          <button 
            [class.active]="ticketType === 'normal'" 
            (click)="ticketType = 'normal'"
            class="ticket-type-btn normal">
            游꿞 Normal
          </button>
          <button 
            [class.active]="ticketType === 'premium'" 
            (click)="ticketType = 'premium'"
            class="ticket-type-btn premium">
            游눑 Premium
          </button>
        </div>
      </div>
      
      <div class="form-group">
        <label>Quantidade:</label>
        <input 
          type="number" 
          [(ngModel)]="ticketAmount" 
          min="1" 
          placeholder="Digite a quantidade"
          class="ticket-input">
      </div>
      
      <div class="ticket-preview">
        <p>Adicionando: <strong>{{ ticketAmount }} tickets {{ ticketType === 'normal' ? 'normais' : 'premium' }}</strong></p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button (click)="closeTicketModal()" class="btn-cancel">Cancelar</button>
      <button (click)="confirmAddTickets()" [disabled]="ticketAmount <= 0" class="btn-confirm">Confirmar</button>
    </div>
  </div>
</div>

<!-- Modal de Alterar Cargo -->
<div class="modal-overlay" *ngIf="showRoleModal" (click)="closeRoleModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Alterar Cargo</h3>
      <button class="close-btn" (click)="closeRoleModal()">칑</button>
    </div>
    
    <div class="modal-body">
      <p><strong>Usu치rio:</strong> {{ selectedUser?.username }}</p>
      
      <div class="form-group">
        <label>Novo Cargo:</label>
        <select [(ngModel)]="newUserType" class="role-select">
          <option value="PLAYER">Player</option>
          <option value="VIP">VIP</option>
          <option value="ADMINISTRADOR">Administrador</option>
        </select>
      </div>
    </div>
    
    <div class="modal-footer">
      <button (click)="closeRoleModal()" class="btn-cancel">Cancelar</button>
      <button (click)="confirmChangeRole()" class="btn-confirm">Confirmar</button>
    </div>
  </div>
</div>

<!-- Modal de Ver Invent치rio -->
<div class="modal-overlay" *ngIf="showInventoryModal" (click)="closeInventoryModal()">
  <div class="modal-content large-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Invent치rio de {{ selectedUser?.username }}</h3>
      <button class="close-btn" (click)="closeInventoryModal()">칑</button>
    </div>
    
    <div class="modal-body">
      <div class="inventory-actions">
        <button (click)="openAddItemModal()" class="btn-action">+ Adicionar Item</button>
      </div>
      
      <div class="inventory-list" *ngIf="userItems.length > 0; else noItems">
        <div class="item-card" *ngFor="let userItem of userItems">
          <img [src]="userItem.item.imageUrl" [alt]="userItem.item.name" class="item-image">
          <div class="item-info">
            <h4>{{ userItem.item.name }}</h4>
            <p>Raridade: {{ userItem.item.rarity }}</p>
            <div *ngIf="userItem.item.rarity === 'LENDARIO' || userItem.item.rarity === 'MITICO'">
              <p>N칤vel de Raridade: {{ userItem.rarityLevel }}</p>
            </div>
            <p>Poder: {{ userItem.item.power }}</p>
            <p *ngIf="userItem.quantity > 1">Quantidade: {{ userItem.quantity }}</p>
          </div>
          <div *ngIf="userItem.quantity > 1" class="quantity-remove">
            <input type="number" [(ngModel)]="removeQuantities[userItem.id]" min="1" [max]="userItem.quantity" placeholder="Qtd" class="quantity-input">
          </div>
          <button (click)="removeItem(userItem)" class="btn-remove">Remover</button>
        </div>
      </div>
      <ng-template #noItems>
        <p>Este usu치rio n칚o possui itens.</p>
      </ng-template>
    </div>
  </div>
</div>

<!-- Modal de Adicionar Item -->
<div class="modal-overlay" *ngIf="showAddItemModal" (click)="closeAddItemModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Adicionar Item</h3>
      <button class="close-btn" (click)="closeAddItemModal()">칑</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label>Selecionar Item:</label>
        <select [(ngModel)]="selectedItemId" (change)="onItemSelected()" class="item-select">
          <option value="">Selecione um item</option>
          <option *ngFor="let item of allItems" [value]="item.id">{{ item.name }}</option>
        </select>
      </div>
      <div *ngIf="selectedItem && (selectedItem.rarity === 'LENDARIO' || selectedItem.rarity === 'MITICO')">
        <label>N칤vel de Raridade:</label>
        <input type="number" [(ngModel)]="rarityLevel" min="1" max="1000" placeholder="1-1000">
      </div>
    </div>
    
    <div class="modal-footer">
      <button (click)="closeAddItemModal()" class="btn-cancel">Cancelar</button>
      <button (click)="confirmAddItem()" [disabled]="!selectedItemId" class="btn-confirm">Adicionar</button>
    </div>
  </div>
</div>
